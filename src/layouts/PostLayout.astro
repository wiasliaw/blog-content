---
import BaseLayout from './BaseLayout.astro';
import TableOfContents from '../components/TableOfContents.astro';
import TagList from '../components/TagList.astro';
import LocalGraph from '../components/LocalGraph.astro';
import CodeCopyButton from '../components/CodeCopyButton.astro';
import Lightbox from '../components/Lightbox.astro';
import Backlinks from '../components/Backlinks.astro';
import Breadcrumb from '../components/Breadcrumb.astro';
import { formatDate } from '../utils/date';
import type { MarkdownHeading } from 'astro';

interface Props {
  title: string;
  description: string;
  created: Date;
  modified?: Date;
  showCreated: boolean;
  showModified: boolean;
  dateFormat: string;
  tags: string[];
  headings: MarkdownHeading[];
  slug: string;
}

const { title, description, created, modified, showCreated, showModified, dateFormat, tags, headings, slug } = Astro.props;
---

<BaseLayout
  title={title}
  description={description}
  type="article"
  publishedTime={created}
  modifiedTime={modified}
  tags={tags}
>
  <article class="prose mx-auto">
    <Breadcrumb items={[
      { label: 'Home', href: '/' },
      { label: 'Posts', href: '/archive' },
      { label: title }
    ]} />

    <header class="mb-6 sm:mb-8 pb-4 sm:pb-6 border-b border-border">
      <h1 class="text-2xl sm:text-3xl lg:text-4xl">{title}</h1>
      <div class="flex flex-wrap items-center gap-2 sm:gap-4 text-muted text-xs sm:text-sm">
        {showCreated && (
          <time datetime={created.toISOString()}>{formatDate(created, dateFormat)}</time>
        )}
        {showModified && modified && (
          <span class="flex items-center gap-1">
            <span>Updated:</span>
            <time datetime={modified.toISOString()}>{formatDate(modified, dateFormat)}</time>
          </span>
        )}
      </div>
      {tags.length > 0 && (
        <div class="mt-3 sm:mt-4">
          <TagList tags={tags} />
        </div>
      )}
    </header>

    {headings.length > 0 && <TableOfContents headings={headings} />}

    <div class="post-content">
      <slot />
    </div>

    <CodeCopyButton />
    <Lightbox />

    <footer class="mt-8 sm:mt-12 pt-6 sm:pt-8 border-t border-border">
      <Backlinks currentSlug={slug} />
      <LocalGraph currentSlug={slug} />
    </footer>
  </article>
</BaseLayout>
