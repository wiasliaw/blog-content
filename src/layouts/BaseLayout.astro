---
import Head from '../components/Head.astro';
import ThemeToggle from '../components/ThemeToggle.astro';
import Search from '../components/Search.astro';
import '../styles/global.css';

interface Props {
  title: string;
  description?: string;
  type?: 'website' | 'article';
  publishedTime?: Date;
  modifiedTime?: Date;
  tags?: string[];
}

const { title, description, type, publishedTime, modifiedTime, tags } = Astro.props;
---

<!DOCTYPE html>
<html lang="zh-TW">
  <Head
    title={title}
    description={description}
    type={type}
    publishedTime={publishedTime}
    modifiedTime={modifiedTime}
    tags={tags}
  />
  <body>
    <header class="sticky top-2 sm:top-4 z-50 mx-2 sm:mx-4">
      <div class="max-w-[--width-page] mx-auto px-4 sm:px-6 py-3 sm:py-4 flex justify-between items-center bg-background/95 backdrop-blur-md rounded-xl border border-border/50" style="box-shadow: 0 4px 20px -2px rgba(0, 0, 0, 0.15), 0 0 15px -3px rgba(0, 0, 0, 0.1);">
        <a href="/" class="text-lg sm:text-xl font-bold text-foreground hover:text-primary no-underline transition-colors">
          SSG
        </a>

        <!-- Mobile menu button -->
        <button
          id="mobile-menu-btn"
          type="button"
          class="md:hidden neu-button p-2 flex items-center gap-2 text-muted hover:text-foreground transition-colors"
          aria-label="Toggle menu"
          aria-expanded="false"
        >
          <svg class="menu-icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
          <svg class="close-icon w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
          <span class="text-sm font-medium">Menu</span>
        </button>

        <!-- Desktop navigation -->
        <nav class="hidden md:flex items-center gap-4 lg:gap-6">
          <a href="/" class="text-muted font-medium hover:text-primary no-underline transition-colors">Home</a>
          <a href="/archive" class="text-muted font-medium hover:text-primary no-underline transition-colors">Archive</a>
          <a href="/tags" class="text-muted font-medium hover:text-primary no-underline transition-colors">Tags</a>
          <a href="/graph" class="text-muted font-medium hover:text-primary no-underline transition-colors">Graph</a>
          <Search />
          <ThemeToggle />
        </nav>
      </div>

      <!-- Mobile navigation -->
      <nav id="mobile-menu" class="md:hidden hidden mt-2">
        <div class="max-w-[--width-page] mx-auto bg-background/95 backdrop-blur-md rounded-xl border border-border/50" style="box-shadow: 0 4px 20px -2px rgba(0, 0, 0, 0.15), 0 0 15px -3px rgba(0, 0, 0, 0.1);">
          <div class="px-4 py-2">
            <div class="text-xs text-muted uppercase tracking-wider py-2 border-b border-border mb-2">
              Navigation
            </div>
            <div class="flex flex-col">
              <a href="/" class="flex items-center gap-3 text-foreground font-medium hover:text-primary hover:bg-secondary no-underline transition-colors py-3 px-2 rounded-lg">
                <svg class="w-5 h-5 text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                </svg>
                Home
              </a>
              <a href="/archive" class="flex items-center gap-3 text-foreground font-medium hover:text-primary hover:bg-secondary no-underline transition-colors py-3 px-2 rounded-lg">
                <svg class="w-5 h-5 text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path>
                </svg>
                Archive
              </a>
              <a href="/tags" class="flex items-center gap-3 text-foreground font-medium hover:text-primary hover:bg-secondary no-underline transition-colors py-3 px-2 rounded-lg">
                <svg class="w-5 h-5 text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                </svg>
                Tags
              </a>
              <a href="/graph" class="flex items-center gap-3 text-foreground font-medium hover:text-primary hover:bg-secondary no-underline transition-colors py-3 px-2 rounded-lg">
                <svg class="w-5 h-5 text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                </svg>
                Graph
              </a>
            </div>
            <div class="flex items-center gap-4 pt-3 mt-2 border-t border-border">
              <Search />
              <ThemeToggle />
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="max-w-[--width-page] mx-auto px-4 sm:px-6 py-8 sm:py-12 min-h-[calc(100vh-200px)]">
      <slot />
    </main>

    <footer class="mt-8 bg-secondary/50 border-t-2 border-border">
      <div class="max-w-[--width-page] mx-auto px-4 sm:px-6 py-6 sm:py-8 text-center text-muted text-sm">
        <p class="mb-0">Built with <a href="https://astro.build" target="_blank" rel="noopener">Astro</a></p>
      </div>
    </footer>
  </body>
</html>

<script is:inline>
  (function() {
    function initMobileMenu() {
      const btn = document.getElementById('mobile-menu-btn');
      const menu = document.getElementById('mobile-menu');
      const menuIcon = btn?.querySelector('.menu-icon');
      const closeIcon = btn?.querySelector('.close-icon');

      if (!btn || !menu) return;

      // Prevent duplicate listeners
      if (btn.dataset.initialized) return;
      btn.dataset.initialized = 'true';

      btn.addEventListener('click', () => {
        const isOpen = menu.classList.toggle('hidden');
        btn.setAttribute('aria-expanded', (!isOpen).toString());
        menuIcon?.classList.toggle('hidden');
        closeIcon?.classList.toggle('hidden');
      });

      // Close menu when clicking a link
      menu.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
          menu.classList.add('hidden');
          btn.setAttribute('aria-expanded', 'false');
          menuIcon?.classList.remove('hidden');
          closeIcon?.classList.add('hidden');
        });
      });
    }

    // Initialize
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initMobileMenu);
    } else {
      initMobileMenu();
    }

    // Re-initialize after view transitions
    document.addEventListener('astro:after-swap', () => {
      const btn = document.getElementById('mobile-menu-btn');
      if (btn) btn.dataset.initialized = '';
      initMobileMenu();
    });
  })();
</script>
