---
import { getBacklinks } from '../utils/graph';

interface Props {
  currentSlug: string;
}

const { currentSlug } = Astro.props;
const backlinks = await getBacklinks(currentSlug);
---

{backlinks.length > 0 && (
  <section class="backlinks mt-8 pt-8 border-t border-border">
    <h3 class="mt-0 mb-4 text-lg font-semibold flex items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M9 17H7A5 5 0 0 1 7 7h2"/>
        <path d="M15 7h2a5 5 0 1 1 0 10h-2"/>
        <line x1="8" x2="16" y1="12" y2="12"/>
      </svg>
      Linked to this note
    </h3>
    <ul class="list-none pl-0 mb-0 space-y-3">
      {backlinks.map((link) => (
        <li class="neu-card p-4">
          <a
            href={`/posts/${link.id}`}
            class="text-primary font-medium no-underline hover:underline"
          >
            {link.title}
          </a>
          {link.description && (
            <p class="text-sm text-muted mt-1 mb-0 line-clamp-2">
              {link.description}
            </p>
          )}
        </li>
      ))}
    </ul>
  </section>
)}

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
